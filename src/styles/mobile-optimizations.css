/* ========================================
   MOBILE FLICKERING FIXES
   ======================================== */

/* Prevent layout shifts and flickering on mobile */
* {
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  -webkit-tap-highlight-color: transparent;
}

/* Optimize rendering for mobile */
html {
  -webkit-text-size-adjust: 100%;
  -ms-text-size-adjust: 100%;
}

body {
  -webkit-overflow-scrolling: touch;
  -webkit-transform: translateZ(0);
  transform: translateZ(0);
}

/* Fix mobile viewport issues */
@supports (-webkit-touch-callout: none) {
  body {
    -webkit-transform: translate3d(0, 0, 0);
    transform: translate3d(0, 0, 0);
  }
}

/* Optimize transitions for mobile */
@media (max-width: 768px) {
  * {
    transition-duration: 0.2s !important;
    transition-timing-function: ease-out !important;
  }
  
  /* Disable complex animations on mobile */
  .animate-pulse,
  .animate-bounce,
  .animate-spin {
    animation-duration: 0.5s !important;
  }
  
  /* Optimize hover effects for touch devices */
  .hover\:scale-105:hover {
    transform: scale(1.02) !important;
  }
  
  .hover\:scale-110:hover {
    transform: scale(1.05) !important;
  }
  
  /* Fix backdrop blur performance on mobile */
  .backdrop-blur-md,
  .backdrop-blur-lg,
  .backdrop-blur-xl {
    backdrop-filter: blur(8px) !important;
    -webkit-backdrop-filter: blur(8px) !important;
  }
  
  /* Optimize gradients for mobile */
  .bg-gradient-to-r,
  .bg-gradient-to-br,
  .bg-gradient-to-b {
    background-attachment: scroll !important;
  }
  
  /* Fix z-index stacking issues */
  .z-30,
  .z-40,
  .z-50 {
    will-change: auto !important;
  }
  
  /* Optimize grid layouts for mobile */
  .grid {
    contain: layout !important;
  }
  
  /* Fix flex layouts */
  .flex {
    contain: layout !important;
  }
  
  /* Optimize card animations */
  .rounded-lg,
  .rounded-xl,
  .rounded-2xl {
    transform: translateZ(0) !important;
  }
  
  /* Fix button press states */
  button:active,
  .btn:active {
    transform: scale(0.98) !important;
    transition: transform 0.1s ease !important;
  }
  
  /* Optimize text rendering */
  h1, h2, h3, h4, h5, h6,
  p, span, div {
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }
  
  /* Fix image loading flicker */
  img {
    image-rendering: -webkit-optimize-contrast;
    image-rendering: crisp-edges;
  }
  
  /* Optimize scroll performance */
  .overflow-y-auto,
  .overflow-y-scroll {
    -webkit-overflow-scrolling: touch;
    scroll-behavior: smooth;
  }
  
  /* Fix mobile menu animations */
  .mobile-menu,
  .sidebar,
  .mobile-sidebar-optimized {
    transform: translateZ(0) !important;
    -webkit-transform: translateZ(0) !important;
    will-change: transform, opacity !important;
  }
  
  /* Optimize mobile sidebar animations */
  .mobile-sidebar-optimized {
    transition: transform 0.2s ease-out, opacity 0.2s ease-out !important;
    -webkit-transition: transform 0.2s ease-out, opacity 0.2s ease-out !important;
    position: relative !important;
    z-index: 51 !important;
    background: rgba(15, 23, 42, 0.98) !important;
    backdrop-filter: blur(8px) !important;
    -webkit-backdrop-filter: blur(8px) !important;
  }
  
  /* Reduce backdrop blur on mobile for better performance */
  .mobile-sidebar-optimized .backdrop-blur-md {
    backdrop-filter: blur(4px) !important;
    -webkit-backdrop-filter: blur(4px) !important;
  }
  
  /* Optimize navigation item animations */
  .mobile-sidebar-optimized .transition-all {
    transition: background-color 0.15s ease-out !important;
  }
  
  /* Remove scale transforms on mobile for better performance */
  .mobile-sidebar-optimized .active\:scale-95:active {
    transform: none !important;
  }
  
  /* Ensure mobile sidebar overlay covers content properly */
  .mobile-sidebar-overlay {
    position: fixed !important;
    top: 0 !important;
    left: 0 !important;
    right: 0 !important;
    bottom: 0 !important;
    z-index: 50 !important;
    background: rgba(0, 0, 0, 0.6) !important;
    backdrop-filter: blur(4px) !important;
    -webkit-backdrop-filter: blur(4px) !important;
  }
  
  /* Hide main content when mobile sidebar is open */
  .mobile-sidebar-open .main-content {
    overflow: hidden !important;
    pointer-events: none !important;
  }
  
  /* Optimize dashboard cards */
  .dashboard-card,
  .stat-card {
    contain: layout style paint !important;
    transform: translateZ(0) !important;
  }
  
  /* Fix Smart Overview grid */
  .grid.grid-cols-1.md\\:grid-cols-2.lg\\:grid-cols-3 {
    contain: layout !important;
  }
  
  /* Optimize button transitions */
  button,
  .btn {
    transition: all 0.2s ease !important;
    transform: translateZ(0) !important;
  }
  
  /* Fix modal animations */
  .modal,
  .popup {
    transform: translateZ(0) !important;
    -webkit-transform: translateZ(0) !important;
  }
}

/* Additional mobile optimizations for very small screens */
@media (max-width: 480px) {
  /* Reduce animation complexity further */
  * {
    transition-duration: 0.15s !important;
  }
  
  /* Optimize text sizes */
  .text-xs { font-size: 0.7rem !important; }
  .text-sm { font-size: 0.8rem !important; }
  .text-base { font-size: 0.9rem !important; }
  
  /* Optimize spacing */
  .p-4 { padding: 0.75rem !important; }
  .p-6 { padding: 1rem !important; }
  .gap-4 { gap: 0.75rem !important; }
  .gap-6 { gap: 1rem !important; }
  
  /* Fix touch targets */
  button,
  .btn,
  a {
    min-height: 44px !important;
    min-width: 44px !important;
  }
}

/* Fix for iOS Safari specific issues */
@supports (-webkit-touch-callout: none) {
  .dashboard-container,
  .main-content {
    -webkit-transform: translate3d(0, 0, 0);
    transform: translate3d(0, 0, 0);
  }
  
  /* Fix iOS scroll bounce and enable pull-to-refresh */
  body {
    overscroll-behavior: none;
    -webkit-overflow-scrolling: touch;
  }
  
  /* Enable pull-to-refresh on mobile */
  main {
    overscroll-behavior-y: contain;
    -webkit-overflow-scrolling: touch;
  }
  
  /* Ensure touch events work properly */
  .mobile-content {
    touch-action: pan-y;
    -webkit-overflow-scrolling: touch;
  }
  
  /* Fix iOS input zoom */
  input,
  textarea,
  select {
    font-size: 16px !important;
  }
}

/* Performance optimizations for low-end devices */
@media (prefers-reduced-motion: reduce) {
  * {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }
}

/* Fix for devices with limited GPU */
@media (max-width: 768px) and (max-height: 600px) {
  .backdrop-blur-md,
  .backdrop-blur-lg {
    backdrop-filter: none !important;
    -webkit-backdrop-filter: none !important;
    background: rgba(0, 0, 0, 0.8) !important;
  }
}

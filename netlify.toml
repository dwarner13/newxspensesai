[build]
  command = "pnpm build"
  publish = "dist"

[functions]
  directory = "netlify/functions"
  node_bundler = "esbuild"
  # Mark dependencies as external to avoid CommonJS bundling issues
  # jsdom is marked external because it's used by safe_web_research tool but doesn't bundle well
  external_node_modules = ["@supabase/supabase-js", "openai", "undici", "jsdom", "@mozilla/readability"]

[dev]
  # Netlify Dev will start on port 8888
  port = 8888
  # Serve built files from dist (for production-like testing)
  publish = "dist"
  # Start Vite dev server automatically when running 'netlify dev'
  command = "npm run vite -- --port 5173"
  # Vite runs on port 5173, Netlify Dev proxies to it
  targetPort = 5173
  # Use custom framework detection (Vite + React)
  framework = "#custom"
  # Temporarily skip function building to get server running
  # Functions will be built on-demand when called
  # functions = []

[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200
